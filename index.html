<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>分数の掛け算トレーニング</title>
  <style>
    .fraction { display: inline-block; text-align: center; margin: 0 10px; }
    .numerator { border-bottom: 1px solid black; }
    .operator { font-weight: bold; margin: 0 5px; }
    button { margin-right: 10px; }
  </style>
</head>
<body>
  <h1>分数の掛け算トレーニング</h1>
  <div id="problem"></div>
  <div style="margin-top: 10px;">
    <button onclick="showAnswer()">答えを見る</button>
    <button onclick="nextProblem()">次の問題</button>
  </div>
  <div id="answer" style="margin-top: 10px;"></div>

  <script>
    function gcd(a, b) {
      return b === 0 ? a : gcd(b, a % b);
    }

    function reduceFraction(numerator, denominator) {
      const g = gcd(numerator, denominator);
      return [numerator / g, denominator / g];
    }

    function generateProblem() {
      let a, b, e, f, m, n, c, d;

      do {
        do {
          a = Math.floor(Math.random() * 9) + 1;
          b = Math.floor(Math.random() * 9) + 1;
        } while (gcd(a, b) !== 1);

        do {
          e = Math.floor(Math.random() * 9) + 1;
          f = Math.floor(Math.random() * 9) + 1;
        } while (gcd(e, f) !== 1);

        m = Math.floor(Math.random() * 4) + 1;
        n = Math.floor(Math.random() * 4) + 1;

        c = m * b * f;
        d = n * a * e;
      } while (c > 200 || d > 200);

      return {
        fractions: [[a, b], [c, d], [e, f]]
      };
    }

    let currentProblem;

    function displayProblem() {
      const [f1, f2, f3] = currentProblem.fractions;
      const problemDiv = document.getElementById("problem");
      const answerDiv = document.getElementById("answer");
      answerDiv.textContent = ""; // 答えをリセット

      problemDiv.innerHTML = `
        <span class="fraction">
          <div class="numerator">${f1[0]}</div>
          <div>${f1[1]}</div>
        </span>
        <span class="operator">×</span>
        <span class="fraction">
          <div class="numerator">${f2[0]}</div>
          <div>${f2[1]}</div>
        </span>
        <span class="operator">×</span>
        <span class="fraction">
          <div class="numerator">${f3[0]}</div>
          <div>${f3[1]}</div>
        </span>
      `;
    }

    function showAnswer() {
      const [f1, f2, f3] = currentProblem.fractions;
      const num = f1[0] * f2[0] * f3[0];
      const den = f1[1] * f2[1] * f3[1];
      const [rNum, rDen] = reduceFraction(num, den);
      document.getElementById("answer").textContent = `答え：${rNum}/${rDen}`;
    }

    function nextProblem() {
      currentProblem = generateProblem();
      displayProblem();
    }

    // 初期表示
    nextProblem();
  </script>
</body>
</html>
