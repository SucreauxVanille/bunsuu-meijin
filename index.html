<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>分数名人君</title>
  <style>
    .fraction {
      display: inline-block;
      text-align: center;
      vertical-align: middle;
      margin: 0 10px;
    }
    .numerator {
      border-bottom: 1px solid black;
    }
    .operator {
      display: inline-block;
      vertical-align: middle;
      font-size: 24px;
      margin: 0 5px;
    }
    button {
      margin-right: 10px;
    }
  </style>
</head>
<body>
  <h1>分数名人君</h1>
  <div id="problem" style="font-size: 24px;"></div>
  <div style="margin-top: 10px;">
    <button onclick="showAnswer()">答えを見る</button>
    <button onclick="nextProblem()">次の問題</button>
  </div>
  <div id="answer" style="margin-top: 10px; font-size: 20px;"></div>

  <script>
    function gcd(a, b) {
      return b === 0 ? a : gcd(b, a % b);
    }

    function reduceFraction(numerator, denominator) {
      const g = gcd(numerator, denominator);
      return [numerator / g, denominator / g];
    }

function generateProblem() {
  let a, b, e, f, m, n, c, d;

  do {
    // a/b：既約で b ∈ [2,20]
    do {
      a = Math.floor(Math.random() * 20) + 1;      // a ∈ [1,20]
      b = Math.floor(Math.random() * 19) + 2;      // b ∈ [2,20]
    } while (gcd(a, b) !== 1);

    // e/f：既約で f ∈ [2,20]
    do {
      e = Math.floor(Math.random() * 20) + 1;      // e ∈ [1,20]
      f = Math.floor(Math.random() * 19) + 2;      // f ∈ [2,20]
    } while (gcd(e, f) !== 1);

    // m, n を調整し、m*b*f と n*a*e が互いに素になるまで繰り返す
    let tries = 0;
    do {
      m = Math.floor(Math.random() * 10) + 1;
      n = Math.floor(Math.random() * 10) + 1;
      c = m * b * f;
      d = n * a * e;
      tries++;
      // 無限ループ防止（10回で諦め）
      if (tries > 10) break;
    } while (gcd(c, d) !== 1);

  } while (c > 200 || d > 200 || gcd(c, d) !== 1);

  return {
    fractions: [[a, b], [c, d], [e, f]]
  };
}

    let currentProblem;

    function displayProblem() {
      const [f1, f2, f3] = currentProblem.fractions;
      const problemDiv = document.getElementById("problem");
      const answerDiv = document.getElementById("answer");
      answerDiv.textContent = ""; // 答えをリセット

      const makeFractionHTML = ([num, den]) => `
        <span class="fraction">
          <div class="numerator">${num}</div>
          <div>${den}</div>
        </span>
      `;

      problemDiv.innerHTML =
        makeFractionHTML(f1) +
        `<span class="operator">×</span>` +
        makeFractionHTML(f2) +
        `<span class="operator">×</span>` +
        makeFractionHTML(f3);
    }

    function showAnswer() {
      const [f1, f2, f3] = currentProblem.fractions;
      const num = f1[0] * f2[0] * f3[0];
      const den = f1[1] * f2[1] * f3[1];
      const [rNum, rDen] = reduceFraction(num, den);
      document.getElementById("answer").textContent = `答え：${rNum}/${rDen}`;
    }

    function nextProblem() {
      currentProblem = generateProblem();
      displayProblem();
    }

    // 初期表示
    nextProblem();
  </script>
</body>
</html>
