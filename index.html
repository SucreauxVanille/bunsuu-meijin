<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>分数名人君</title>
  <style>
    body {
      font-family: sans-serif;
      text-align: center;
      padding: 20px;
    }
    .fraction {
      display: inline-block;
      text-align: center;
      vertical-align: middle;
      margin: 0 5px;
    }
    .fraction .top {
      border-bottom: 1px solid #000;
      padding: 2px 4px;
    }
    .fraction .bottom {
      padding: 2px 4px;
    }
    .centered {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }
    .fraction-bar {
      border-top: 1px solid #000;
      width: 30px;
      margin: 0 auto;
    }
    button {
      margin: 10px;
      padding: 10px 15px;
      font-size: 16px;
    }
  </style>
</head>
<body>
  <h1>分数名人君</h1>
  <div id="problem" class="centered"></div>

  <h3>答えを入力：</h3>
  <div class="centered">
    <input type="number" id="userNumerator" placeholder="分子" style="width: 50px;" />
    <div class="fraction-bar"></div>
    <input type="number" id="userDenominator" placeholder="分母" style="width: 50px;" />
  </div>

  <div class="centered">
    <button onclick="checkAnswer()">答え合わせ</button>
    <div id="feedback"></div>
    <div id="buttons"></div>
  </div>

  <script>
    let a, b, c, d, e, f, m, n;
    let correctNumerator, correctDenominator;

    function gcd(x, y) {
      while (y) [x, y] = [y, x % y];
      return x;
    }

    function generateProblem() {
      do {
        a = Math.floor(Math.random() * 20) + 1;
        b = Math.floor(Math.random() * 19) + 2; // b > 1
        e = Math.floor(Math.random() * 20) + 1;
        f = Math.floor(Math.random() * 19) + 2; // f > 1
        do {
          m = Math.floor(Math.random() * 10) + 1;
          n = Math.floor(Math.random() * 9) + 2; // n > 1
        } while (gcd(m * b * f, n * a * e) !== 1);
        c = m * b * f;
        d = n * a * e;
      } while (c > 200 || d > 200);

      const problemDiv = document.getElementById("problem");
      problemDiv.innerHTML = `
        <div class="fraction"><div class="top">${a}</div><div class="bottom">${b}</div></div>
        <span style="vertical-align: middle; font-size: 20px;">×</span>
        <div class="fraction"><div class="top">${c}</div><div class="bottom">${d}</div></div>
        <span style="vertical-align: middle; font-size: 20px;">×</span>
        <div class="fraction"><div class="top">${e}</div><div class="bottom">${f}</div></div>
      `;

      let num = a * c * e;
      let den = b * d * f;
      let g = gcd(num, den);
      correctNumerator = num / g;
      correctDenominator = den / g;

      document.getElementById("feedback").innerHTML = "";
      document.getElementById("buttons").innerHTML = "";
      document.getElementById("userNumerator").value = "";
      document.getElementById("userDenominator").value = "";
    }

    function checkAnswer() {
      const userNum = parseInt(document.getElementById("userNumerator").value);
      const userDen = parseInt(document.getElementById("userDenominator").value);

      if (userNum === correctNumerator && userDen === correctDenominator) {
        document.getElementById("feedback").innerHTML = "<p style='color:green;'>正解です！</p>";
        document.getElementById("buttons").innerHTML = '<button onclick="generateProblem()">次の問題</button>';
      } else {
        document.getElementById("feedback").innerHTML = "<p style='color:red;'>不正解です。</p>";
        document.getElementById("buttons").innerHTML = `
          <button onclick="retryAnswer()">再挑戦する</button>
          <button onclick="showAnswer()">答えを見る</button>
        `;
      }
    }

    function retryAnswer() {
      document.getElementById("feedback").innerHTML = "";
      document.getElementById("buttons").innerHTML = "";
      document.getElementById("userNumerator").value = "";
      document.getElementById("userDenominator").value = "";
    }

    function showAnswer() {
      document.getElementById("feedback").innerHTML = `
        <p>正解：</p>
        <div class="fraction"><div class="top">${correctNumerator}</div><div class="bottom">${correctDenominator}</div></div>
      `;
      document.getElementById("buttons").innerHTML = '<button onclick="generateProblem()">次の問題</button>';
    }

    generateProblem();
  </script>
</body>
</html>
